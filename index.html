<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pressure Injury Staging + Interventions</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    /* from your original tool */
    --primary:#2563eb; --primary-dark:#1d4ed8; --secondary:#0f172a; --light:#f8fafc; --gray:#94a3b8;
    --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --border-radius:12px; --box-shadow:0 10px 25px -5px rgba(0,0,0,.1); --transition:all .3s ease;
    /* interventions card palette (subtle) */
    --card:#ffffff; --line:#e2e8f0; --pill:#eef2ff; --pill-ink:#3730a3;
  }
  *{box-sizing:border-box}
  body{
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:linear-gradient(135deg,#f0f9ff 0%,#e0f2fe 100%);
    min-height:100vh;padding:20px;color:#1e293b;
  }
  .container{max-width:980px;margin:0 auto;background:#fff;border-radius:var(--border-radius);box-shadow:var(--box-shadow);overflow:hidden}
  .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:#fff;padding:26px 32px}
  .header h1{margin:0 0 6px;font-weight:700;font-size:2rem;letter-spacing:-.5px}
  .header p{margin:0;opacity:.9}
  .content{padding:28px 32px}

  /* progress + steps */
  .progress-container{margin:16px 0 22px}
  .progress-bar{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden}
  .progress{height:100%;background:linear-gradient(90deg,var(--primary) 0%,var(--primary-dark) 100%);border-radius:4px;transition:width .4s ease}
  .step-indicator{display:flex;justify-content:space-between;margin-bottom:24px;position:relative}
  .step-indicator::before{content:"";position:absolute;top:20px;left:0;right:0;height:2px;background:#e2e8f0;z-index:1}
  .step{position:relative;z-index:2;text-align:center;width:100%}
  .step-number{width:40px;height:40px;border-radius:50%;background:#e2e8f0;display:flex;align-items:center;justify-content:center;margin:0 auto 8px;font-weight:600;color:#64748b;transition:var(--transition)}
  .step.active .step-number{background:var(--primary);color:#fff;transform:scale(1.08)}
  .step-label{font-size:.85rem;font-weight:500;color:#64748b}
  .step.active .step-label{color:var(--primary);font-weight:600}

  /* questions */
  .question{margin-bottom:24px;padding:22px;border-radius:var(--border-radius);background:#f8fafc;border:1px solid #e2e8f0;transition:var(--transition);box-shadow:0 2px 5px rgba(0,0,0,.03)}
  .question.active{background:#fff;border-color:var(--primary);box-shadow:0 5px 15px rgba(37,99,235,.1)}
  .question h3{margin:0 0 16px;color:#0f172a;font-size:1.2rem;font-weight:600}
  .options{display:grid;gap:12px}
  .option{padding:16px 18px;border:2px solid #e2e8f0;border-radius:10px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;background:#fff}
  .option:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.05)}
  .option input{margin-right:14px;width:20px;height:20px;cursor:pointer}
  .option label{cursor:pointer;flex:1;font-weight:500;font-size:1.02rem}
  .option input:checked + label{color:var(--primary);font-weight:600}

  /* result/staging panel */
  .result-container{background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 100%);border-radius:var(--border-radius);padding:26px;text-align:center;margin:26px 0;border:1px solid #bbf7d0;box-shadow:0 4px 6px rgba(16,185,129,.1);animation:fadeIn .5s ease-out}
  .result-title{color:#166534;font-size:1.4rem;font-weight:800;margin-bottom:14px}
  #resultText{font-size:1.05rem;line-height:1.6;color:#166534;font-weight:600}

  /* comparison */
  .comparison-container{margin-top:18px;padding:16px;background:#f1f5f9;border-radius:12px;border:1px solid #e2e8f0}
  .comparison-title{font-size:1.05rem;font-weight:700;color:#0f172a;margin-bottom:12px;text-align:center}
  .comparison-item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e2e8f0}
  .comparison-item:last-child{border-bottom:none}
  .comparison-label{font-weight:500;color:#334155}
  .comparison-value{font-weight:700}
  .initial-value{color:#ef4444}
  .final-value{color:#10b981}

  /* interventions block */
  .interventions{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);padding:18px 18px 20px;margin:14px 0}
  .interventions header{display:flex;flex-wrap:wrap;align-items:center;gap:8px;margin-bottom:8px}
  .interventions h2{font-size:1.1rem;margin:0 8px 0 0}
  .pill{display:inline-block;padding:6px 10px;border:1px solid var(--line);border-radius:999px;margin:6px 6px 0 0;background:var(--pill);color:var(--pill-ink);font-size:.85rem}
  ol.steps{margin:10px 0 0 20px}
  ol.steps li{margin:6px 0}
  .ib-row{display:grid;gap:10px;margin:10px 0 2px}
  @media(min-width:720px){.ib-row{grid-template-columns:1fr auto auto}}
  input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#fff;outline:none}
  input[type="text"]:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
  .btn{display:inline-block;padding:11px 18px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer;transition:var(--transition);text-align:center;text-decoration:none;font-size:1rem;box-shadow:0 4px 6px rgba(37,99,235,.2)}
  .btn:hover{background:var(--primary-dark);transform:translateY(-2px)}
  .btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}
  .btn-outline:hover{background:var(--primary);color:#fff}
  .btn-ghost{background:#f1f5f9;color:#334155}
  .btn-ghost:hover{background:#e2e8f0}
  .hint{font-size:.85rem;color:#64748b;margin-top:6px}
  .tools{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

  .question-navigation{display:flex;justify-content:space-between;margin-top:20px}
  .btn-prev{background:#e2e8f0;color:#334155}
  .btn-prev:hover{background:#cbd5e1}
  .btn-next{background:var(--primary);color:#fff}

  @keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  @media(max-width:768px){
    .content{padding:20px}
    .header{padding:22px}
    .header h1{font-size:1.7rem}
    .question{padding:18px}
  }
  @media print{
    .header,.question-navigation,.tools,.hint{display:none}
    body{background:#fff}
    .container{box-shadow:none}
    a::after{content:" (" attr(href) ")";font-size:10px}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Pressure Injury Staging + Interventions</h1>
      <p>Start with your best guess, answer the decision questions, then get a ready-to-print intervention checklist.</p>
    </div>

    <div class="content">
      <div class="progress-container">
        <div class="progress-bar"><div class="progress" id="progress" style="width:0%"></div></div>
      </div>

      <!-- Identifier + quick actions -->
      <div class="interventions" style="margin-top:0; padding:12px 16px 6px">
        <div class="ib-row">
          <input id="patientId" type="text" placeholder="Identifier (optional): initials / visit ID only â€” no PHI"/>
          <div class="tools">
            <button class="btn-ghost btn" id="copyBtn" title="Copy intervention list" disabled>Copy list</button>
            <button class="btn-outline btn" id="printBtn" title="Print or save PDF" disabled>Print / PDF</button>
          </div>
        </div>
        <div class="hint">Copy/print activate after the tool determines the stage/type.</div>
      </div>

      <form id="woundForm">
        <!-- Step indicator -->
        <div class="step-indicator">
          <div class="step active" id="step1"><div class="step-number">0</div><div class="step-label">Initial Assessment</div></div>
          <div class="step" id="step2"><div class="step-number">1</div><div class="step-label">Skin Condition</div></div>
          <div class="step" id="step3"><div class="step-number">2</div><div class="step-label">Location</div></div>
          <div class="step" id="step4"><div class="step-number">3</div><div class="step-label">Wound Characteristics</div></div>
          <div class="step" id="step5"><div class="step-number">4</div><div class="step-label">Staging</div></div>
        </div>

        <!-- Questions -->
        <div class="question active" id="question1a">
          <h3>0. What type of pressure injury do you think your wound is?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q0" value="PI Stage 1" id="q0-1"><label for="q0-1">PI Stage 1</label></div>
            <div class="option"><input type="radio" name="q0" value="PI Stage 2" id="q0-2"><label for="q0-2">PI Stage 2</label></div>
            <div class="option"><input type="radio" name="q0" value="PI Stage 3" id="q0-3"><label for="q0-3">PI Stage 3</label></div>
            <div class="option"><input type="radio" name="q0" value="PI Stage 4" id="q0-4"><label for="q0-4">PI Stage 4</label></div>
            <div class="option"><input type="radio" name="q0" value="Unstageable" id="q0-5"><label for="q0-5">Unstageable</label></div>
            <div class="option"><input type="radio" name="q0" value="DTI Deep tissue injury" id="q0-6"><label for="q0-6">DTI Deep tissue injury</label></div>
            <div class="option"><input type="radio" name="q0" value="IAD" id="q0-7"><label for="q0-7">IAD Incontinence-Associated Dermatitis</label></div>
            <div class="option"><input type="radio" name="q0" value="Moisture-Associated Skin Damage (MASD)" id="q0-8"><label for="q0-8">Moisture-Associated Skin Damage (MASD)</label></div>
            <div class="option"><input type="radio" name="q0" value="Not PI" id="q0-9"><label for="q0-9">Not PI</label></div>
            <div class="option"><input type="radio" name="q0" value="Medical related PI" id="q0-10"><label for="q0-10">Medical related PI</label></div>
            <div class="option"><input type="radio" name="q0" value="mucosal membrane PI" id="q0-11"><label for="q0-11">Mucosal membrane PI</label></div>
            <div class="option"><input type="radio" name="q0" value="I have no idea" id="q0-12"><label for="q0-12">I have no idea</label></div>
          </div>
        </div>

        <div class="question" id="question1" style="display:none;">
          <h3>1. Is the skin/ mucosal membrane normal?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q1" value="yes" id="q1-1"><label for="q1-1">Yes</label></div>
            <div class="option"><input type="radio" name="q1" value="no, mucosal membrane abnormal" id="q1-2"><label for="q1-2">No, mucosal membrane abnormal</label></div>
            <div class="option"><input type="radio" name="q1" value="no, skin abnormal" id="q1-3"><label for="q1-3">No, skin abnormal</label></div>
          </div>
        </div>

        <div class="question" id="question2" style="display:none;">
          <h3>2. Is the wound/ skin abnormality a) over the bony prominence area/ related to medical devices AND b)caused by prolonged pressure or shear force?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q2" value="yes, it is over bony promience area" id="q2-1"><label for="q2-1">Yes, it is a)over bony prominence area AND b)caused by prolonged pressure or shear force</label></div>
            <div class="option"><input type="radio" name="q2" value="yes, it is related to medical device" id="q2-2"><label for="q2-2">Yes, it is related to medical device. Then this is medical device related pressure injury (MDRPI)</label></div>
            <div class="option"><input type="radio" name="q2" value="no" id="q2-3"><label for="q2-3">No, it is neither on bony area nor not caused by prolonged pressure or shear force.</label></div>
          </div>
        </div>

        <div class="question" id="question3" style="display:none;">
          <h3>3. Is it an open wound?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q3" value="yes" id="q3-1"><label for="q3-1">Yes</label></div>
            <div class="option"><input type="radio" name="q3" value="no" id="q3-2"><label for="q3-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question4" style="display:none;">
          <h3>4. Do you see bone/ tendon structure? i.e. no slough/ eschar blocks the woundbed</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q4" value="yes" id="q4-1"><label for="q4-1">Yes</label></div>
            <div class="option"><input type="radio" name="q4" value="no" id="q4-2"><label for="q4-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question5" style="display:none;">
          <h3>5. Do you see subcutaneous fat? i.e. no slough/ eschar blocks the woundbed</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q5" value="yes" id="q5-1"><label for="q5-1">Yes</label></div>
            <div class="option"><input type="radio" name="q5" value="no" id="q5-2"><label for="q5-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question5a" style="display:none;">
          <h3>5a. Do you see eschar/slough?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q5a" value="yes" id="q5a-1"><label for="q5a-1">Yes</label></div>
            <div class="option"><input type="radio" name="q5a" value="no" id="q5a-2"><label for="q5a-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question6" style="display:none;">
          <h3>6. Does blister present?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q6" value="yes" id="q6-1"><label for="q6-1">Yes</label></div>
            <div class="option"><input type="radio" name="q6" value="no" id="q6-2"><label for="q6-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question8" style="display:none;">
          <h3>8. Is the skin blanchable? i.e. an area of skin that temporarily turns white or pale when pressure is applied</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q8" value="yes" id="q8-1"><label for="q8-1">Yes</label></div>
            <div class="option"><input type="radio" name="q8" value="no" id="q8-2"><label for="q8-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question10" style="display:none;">
          <h3>10. Is the wound related to moisture?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q10" value="yes" id="q10-1"><label for="q10-1">Yes</label></div>
            <div class="option"><input type="radio" name="q10" value="no" id="q10-2"><label for="q10-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question11" style="display:none;">
          <h3>11. Is the wound located at the perineal area?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q11" value="yes" id="q11-1"><label for="q11-1">Yes</label></div>
            <div class="option"><input type="radio" name="q11" value="no" id="q11-2"><label for="q11-2">No</label></div>
          </div>
        </div>

        <div class="question" id="question12" style="display:none;">
          <h3>12. Is the non-PI wound open?</h3>
          <div class="options">
            <div class="option"><input type="radio" name="q12" value="yes" id="q12-1"><label for="q12-1">Yes</label></div>
            <div class="option"><input type="radio" name="q12" value="no" id="q12-2"><label for="q12-2">No</label></div>
          </div>
        </div>

        <!-- Results + Interventions -->
        <div id="result" style="display:none;">
          <img src="BodyDiagram.png" alt="Body Image" style="max-width:100%;height:auto;margin-top:10px">
          <div class="result-container">
            <div class="result-title">Staging Result</div>
            <p id="resultText"></p>

            <div class="comparison-container" id="comparisonContainer" style="display:none;">
              <div class="comparison-title">Comparison Result</div>
              <div class="comparison-item"><span class="comparison-label">Initial Assessment:</span><span class="comparison-value initial-value" id="initialValue"></span></div>
              <div class="comparison-item"><span class="comparison-label">Final Result:</span><span class="comparison-value final-value" id="finalValue"></span></div>
            </div>
          </div>

          <!-- Interventions panel (auto-filled) -->
          <section class="interventions" id="interventionsPanel" style="display:none;">
            <header>
              <h2 id="ivTitle">Interventions</h2>
              <div id="ivTags"></div>
            </header>
            <ol class="steps" id="ivSteps"></ol>
            <div class="tools" style="margin-top:10px">
              <button class="btn-ghost btn" id="ivCopyBtn">Copy list</button>
              <button class="btn-outline btn" id="ivPrintBtn">Print / PDF</button>
            </div>
            <div class="hint">Educational quick guide. Follow facility policy, WOCN guidance, and provider orders.</div>
          </section>

          <div class="question-navigation" style="margin-top:14px">
            <button type="button" class="btn btn-outline btn-prev" onclick="location.reload()">Start New Assessment</button>
          </div>
        </div>

        <div class="question-navigation">
          <button type="button" class="btn btn-prev btn-outline" id="prevBtn" style="display:none;">Previous</button>
          <button type="button" class="btn btn-next" id="nextBtn">Next</button>
        </div>
      </form>
    </div>
  </div>

<script>
/* ----------------------- DATA: interventions (unchanged) ----------------------- */
const INTERVENTIONS = {
  stage1:{title:"Stage 1 â€“ Interventions",tags:["Offload","Protect","Assess","Cleanse"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "Apply appropriate Mepilex foam to redistribute pressure and shear."
  ]},
  stage2:{title:"Stage 2 â€“ Interventions",tags:["Offload","Moist wound care","Assess","Consults"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "Apply appropriate Mepilex foam to redistribute pressure and shear.",
      "If the serum-filled i.e. clear-filled blister presents, apply PolyMem, then cover with Mepilex (or gauze roll for fragile skin) to prevent accidentally pull off the blister during removal.",
      "Nursing-driven: consult WOCN.",
      "Nursing-driven: consult Nutrition."
  ]},
  stage3:{title:"Stage 3 â€“ Interventions",tags:["Offload","Debridement eval","Infection screen","Consults"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "Apply appropriate Mepilex foam to redistribute pressure and shear.",
      "Contact MD to evaluate and order PTWC consult.",
      "Nursing-driven: consult Nutrition.",
      "If infection is suspected (malodor, slough, purulence), contact MD for wound swab culture order.",
       "Swab technique: Swab viable tissue only (Do not culture pus, slough or eschar); flush the wound with sterile saline; moisten the swab with NS to improve bacterial adherence; forcefully swab ~1 cmÂ² of viable tissue for ~5 seconds; apply enough pressure to express tissue fluid; send to lab."
  ]},
  stage4:{title:"Stage 4 â€“ Interventions",tags:["Offload","Advanced care","Infection screen","Consults"],steps:[
    "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "Apply appropriate Mepilex foam to redistribute pressure and shear.",
      "Contact MD to evaluate and order PTWC consult.",
      "Nursing-driven: consult Nutrition.",
      "If infection is suspected (malodor, slough, purulence), contact MD for wound swab culture order.",
      "Swab technique: Swab viable tissue only (Do not culture pus, slough or eschar); flush the wound with sterile saline; moisten the swab with NS to improve bacterial adherence; forcefully swab ~1 cmÂ² of viable tissue for ~5 seconds; apply enough pressure to express tissue fluid; send to lab."
  ]},
  unstageable:{title:"Unstageable â€“ Interventions",tags:["Offload","Do not stage yet","Debridement eval","Consults"],steps:[
    "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "Apply Mepilex foam to redistribute pressure and shear.",
      "Do NOT apply Mepilex foam to the dry and stable eschar as it will introduce moisture and increase the risk of serious infection. Leave it open to air.",
      "Contact MD to evaluate and order PTWC consult.",
      "Nursing-driven: consult Nutrition.",
      "If infection is suspected (malodor, slough, purulence), contact MD for wound swab culture order.",
      "Swab technique: Swab viable tissue only (Do not culture pus, slough or eschar); flush the wound with sterile saline; moisten the swab with NS to improve bacterial adherence; forcefully swab ~1 cmÂ² of viable tissue for ~5 seconds; apply enough pressure to express tissue fluid; send to lab."
  ]},
  dti:{title:"Deep Tissue Injury (DTI) â€“ Interventions",tags:["Offload","Protect","Monitor closely","Consults"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Ask the patient/family when and how the wound was obtained to understand the etiology and to identify any pressure/ shear forces applied to the wound; determine if hospital-acquired.",
      "Offload pressure: use pillows/wedges/Z-Flo pillow for Q2H turns; apply heel-protector boots as appropriate.",
      "Cleanse with Vashe.",
      "If blood-filled blisters exist, apply PolyMem, then cover with Mepilex (or gauze roll for fragile skin) to prevent accidentally pull off the blister during removal.",
      "Nursing-driven: consult WOCN.",
      "Nursing-driven: consult Nutrition."
  ]},
  iad:{title:"Incontinence-Associated Dermatitis (IAD) â€“ Interventions",tags:["Cleanse","Protect","Moisture control"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Cleanse with Vashe; dry thoroughly.",
      "Apply 3M Cavilon Advanced Skin Protectant.",
      "Partial-thickness loss IAD: apply Triad cream.",
      "Intact IAD: apply zinc cream.",
      "Consult WOCN for MASD treatment as appropriate."
  ]},
  masd:{title:"Intertriginous/MASD â€“ Interventions",tags:["Keep folds dry","Antifungal if needed","Protect"],steps:[
     "2 RN co-sign on Epic when admission.",
      "Use Rover to capture the wound photo.",
      "Cleanse with Vashe; dry thoroughly.",
      "Apply InterDry to separate the skin folds.",
      "Apply antifungal powder to the skin folds.",
      "Consult WOCN for MASD treatment as appropriate."
  ]},
  notpi:{title:"Not a Pressure Injury â€“ Actions",tags:["Different etiology","Document correctly"],steps:[
      "2 RN co-sign on Epic when admission.",
      "If braden score <18 or mobility <2, Use Rover to capture heels, sacral baseline photo.",
      "Document per wound characteristics (e.g., bruise, rash, cellulitis, laceration, venous ulcer, surgical wound).",
      "Follow non-PI protocols and provider/WOCN guidance as indicated.",
      "Address contributing factors (shear, moisture, device pressure) even if not PI."
  ]},
  mucosal:{title:"Mucosal Membrane Pressure Injury â€“ Actions",tags:["Device-related","Cannot be staged"],steps:[
    "Recognize mucosal site PI usually related to medical devices; these cannot be staged.",
    "Protect and offload device pressure; review device necessity and fit.",
    "Consult WOCN/provider for specific care and documentation language."
  ]},
  braden:{title:"No Pressure Injury â€“ Actions",tags:["Prevention","Risk assessment"],steps:[
      "2 RN co-sign on Epic when admission.",
      "If braden score <18 or mobility <2, Use Rover to capture heels, sacral baseline photo.",
      "Document per wound characteristics (e.g., bruise, rash, cellulitis, laceration, venous ulcer, surgical wound).",
      "Follow non-PI protocols and provider/WOCN guidance as indicated.",
      "Address contributing factors (shear, moisture, device pressure) even if not PI."
  ]}
};

/* ----------------------- Helpers: progress + steps ----------------------- */
const stepIndicators = document.querySelectorAll('.step');
const questionsOrder = ['question1a','question1','question2','question3','question4','question5','question5a','question6','question8','question10','question11','question12'];
let currentIndex = 0;

function updateProgress(){
  const pct = (currentIndex / questionsOrder.length) * 100;
  document.getElementById('progress').style.width = `${pct}%`;
}
function updateSteps(){
  stepIndicators.forEach((s,i)=> i <= currentIndex ? s.classList.add('active') : s.classList.remove('active'));
}
function showQuestion(id){
  // hide all questions + result
  document.querySelectorAll('.question').forEach(q=>{q.classList.remove('active'); q.style.display='none';});
  document.getElementById('result').style.display='none';
  // show the requested one
  const el = document.getElementById(id);
  if(el){ el.style.display='block'; el.classList.add('active'); }
  // sync index + UI
  const idx = questionsOrder.indexOf(id);
  if(idx >= 0) currentIndex = idx;
  document.getElementById('prevBtn').style.display = currentIndex>0 ? 'inline-block' : 'none';
  document.getElementById('nextBtn').style.display = 'inline-block';
  updateProgress(); updateSteps();
}

/* ---------- Map result text -> intervention key ---------- */
function classifyKeyFromResultText(txt){
  const t = txt.toLowerCase();
  if(t.includes('stage 4')) return 'stage4';
  if(t.includes('stage 3')) return 'stage3';
  if(t.includes('stage 2')) return 'stage2';
  if(t.includes('stage 1')) return 'stage1';
  if(t.includes('unstageable')) return 'unstageable';
  if(t.includes('deep tissue injury') || t.includes(' dti') || t.includes('= dti')) return 'dti';
  if(t.includes('iad')) return 'iad';
  if(t.includes('masd')) return 'masd';
  if(t.includes('mucosal')) return 'mucosal';
  if(t.includes('no pressure injury')) return 'braden';
  if(t.includes('not a pi')) return 'notpi';
  return null;
}

/* ---------- Render Interventions ---------- */
const ivPanel = document.getElementById('interventionsPanel');
const ivTitle = document.getElementById('ivTitle');
const ivTags = document.getElementById('ivTags');
const ivSteps = document.getElementById('ivSteps');
const ivCopyBtn = document.getElementById('ivCopyBtn');
const ivPrintBtn = document.getElementById('ivPrintBtn');
const copyBtnTop = document.getElementById('copyBtn');
const printBtnTop = document.getElementById('printBtn');
const pid = document.getElementById('patientId');

function renderInterventions(key){
  const data = INTERVENTIONS[key];
  if(!data){ivPanel.style.display='none';return;}
  ivTitle.textContent = data.title;
  ivTags.innerHTML = data.tags.map(t=>`<span class="pill">${t}</span>`).join('');
  ivSteps.innerHTML = data.steps.map(s=>`<li>${s}</li>`).join('');
  ivPanel.style.display='block';
  [ivCopyBtn,ivPrintBtn,copyBtnTop,printBtnTop].forEach(b=>b && (b.disabled=false));
}
async function copyCurrentList(targetBtn){
  const title = ivTitle.textContent || 'Interventions';
  const idText = pid.value ? `Identifier: ${pid.value}\n` : '';
  const steps = [...ivSteps.querySelectorAll('li')].map((li,i)=>`${i+1}. ${li.textContent}`).join('\n');
  const blob = `${title}\n${idText}\n${steps}\n\n(Guide: follow facility policy, WOCN guidance, and provider orders.)`;
  try{
    await navigator.clipboard.writeText(blob);
    targetBtn.textContent = 'Copied âœ“';
    setTimeout(()=> targetBtn.textContent = 'Copy list', 1200);
  }catch{ alert('Could not copy. Your browser may block clipboard access.'); }
}
ivCopyBtn.addEventListener('click', ()=>copyCurrentList(ivCopyBtn));
copyBtnTop.addEventListener('click', ()=>copyCurrentList(copyBtnTop));
ivPrintBtn.addEventListener('click', ()=>window.print());
printBtnTop.addEventListener('click', ()=>window.print());

/* ---------- Show Result + Interventions + Submit ---------- */
let initialAssessment = '';

function showResult(resultText){
  // hide all questions
  document.querySelectorAll('.question').forEach(q=>{q.classList.remove('active');q.style.display='none'});
  // show result
  document.getElementById('resultText').innerHTML = resultText;
  document.getElementById('result').style.display='block';
  document.getElementById('nextBtn').style.display='none';
  document.getElementById('prevBtn').style.display='none';
  document.getElementById('comparisonContainer').style.display='block';
  document.getElementById('initialValue').textContent = initialAssessment || 'Not specified';
  document.getElementById('finalValue').textContent = resultText;

  // progress/steps
  currentIndex = questionsOrder.length; updateProgress(); updateSteps();

  // interventions
  const key = classifyKeyFromResultText(resultText);
  if(key && INTERVENTIONS[key]) renderInterventions(key);
  else ivPanel.style.display='none';

  // submit to Apps Script
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbwHc_j7cl3b86ETCTmc5h5wE-PKU9q6T9W-dUQN6-JplMwRG83uNrI5dWYC92UlhSwxRA/exec';
  (async function submitResults(result1,result2){
    const form = new FormData();
    form.append('result1', result1);
    form.append('result2', result2);
    try{ await fetch(ENDPOINT,{method:'POST',body:form,mode:'no-cors'});}catch(e){}
  })(initialAssessment, resultText);
}

/* ----------------------- Branching: EXACTLY like index.html ----------------------- */
document.addEventListener('DOMContentLoaded', ()=>{
  // init
  updateProgress(); updateSteps();
  document.getElementById('prevBtn').style.display='none';

  // Next/Prev (linear) â€“ optional convenience
  document.getElementById('nextBtn').addEventListener('click', ()=>{
    const nextId = questionsOrder[Math.min(currentIndex+1, questionsOrder.length-1)];
    showQuestion(nextId);
  });
  document.getElementById('prevBtn').addEventListener('click', ()=>{
    const prevId = questionsOrder[Math.max(currentIndex-1, 0)];
    showQuestion(prevId);
  });

  // Radio logic: mirror index.html flow
  document.querySelectorAll('input[type="radio"]').forEach(r=>{
    r.addEventListener('change', function(){
      const nm = this.name, val = this.value;

      // Q0 -> capture + go to Q1
      if(nm==='q0'){ initialAssessment = val; showQuestion('question1'); return; }

      // Q1
      if(nm==='q1'){
        if(val==='yes') return showResult('There is no Pressure Injury. Perform Braden Score.');
        if(val==='no, mucosal membrane abnormal') return showResult('Mucosal membrane pressure injuries occur on mucous membranes, usually where a medical device has been in place.<br>These injuries cannot be staged.');
        if(val==='no, skin abnormal') return showQuestion('question2');
      }

      // Q2
      if(nm==='q2'){
        if(val==='yes, it is over bony promience area') return showQuestion('question3');
        if(val==='yes, it is related to medical device') return showQuestion('question3'); // keep flow identical
        if(val==='no') return showQuestion('question10');
      }

      // Q3
      if(nm==='q3'){
        if(val==='yes') return showQuestion('question4');
        if(val==='no') return showQuestion('question6');
      }

      // Q4
      if(nm==='q4'){
        if(val==='yes') return showResult('It is Stage 4 PI.');
        if(val==='no') return showQuestion('question5');
      }

      // Q5
      if(nm==='q5'){
        if(val==='yes') return showResult('It is Stage 3 PI.');
        if(val==='no') return showQuestion('question5a');
      }

      // Q5a
      if(nm==='q5a'){
        if(val==='yes') return showResult('It is Unstageable.');
        if(val==='no') return showResult('It is Stage 2.');
      }

      // Q6
      if(nm==='q6'){
        if(val==='yes') return showResult('Blood filled blister = Deep Tissue Injury (DTI).<br>Serous i.e. clear filled blister = Stage 2 PI.');
        if(val==='no') return showQuestion('question8');
      }

      // Q8
      if(nm==='q8'){
        if(val==='yes') return showResult('It is not a PI.');
        if(val==='no') return showResult('Light purple = DTI<br>Non-blanchable redness = Stage 1 PI.');
      }

      // Q10
      if(nm==='q10'){
        if(val==='yes') return showQuestion('question11');
        if(val==='no') return showQuestion('question12');
      }

      // Q11
      if(nm==='q11'){
        if(val==='yes') return showResult('It is not PI but IAD (incontinence associated dermatitis).');
        if(val==='no') return showResult('It is not PI but MASD (moisture associated skin damage).');
      }

      // Q12
      if(nm==='q12'){
        if(val==='yes') return showResult('Chart the wound according to its characteristics, e.g. laceration, abrasion, open surgical wound, venous ulcer etc.');
        if(val==='no') return showResult('Chart the wound according to its characteristics, e.g. bruise, rash, cellulitis, etc.');
      }
    });
  });
});
</script>
</body>
</html>
